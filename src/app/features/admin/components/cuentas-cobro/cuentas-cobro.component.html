<div class="space-y-6">
  <div
    class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
  >
    <h2 class="text-2xl font-bold text-neutral-900">Cuentas de Cobro</h2>
  </div>

  <div class="bg-white rounded-xl shadow-soft p-4">
    <div class="flex-1 relative mb-4">
      <i
        class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400"
      ></i>
      <input
        type="text"
        [(ngModel)]="terminoBusqueda"
        (input)="onBuscar(terminoBusqueda)"
        placeholder="Buscar por nombre del cliente o identificación..."
        class="w-full pl-10 pr-10 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
      />
      <button
        *ngIf="terminoBusqueda"
        (click)="onLimpiarBusqueda()"
        type="button"
        class="absolute right-3 top-1/2 transform -translate-y-1/2 text-neutral-400 hover:text-neutral-600 transition-colors"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="border-t border-neutral-200 pt-4">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-sm font-semibold text-neutral-700">Filtros</h3>
        <button
          (click)="mostrarFiltros = !mostrarFiltros"
          type="button"
          class="text-sm text-primary-600 hover:text-primary-700 transition-colors"
        >
          <i
            [class.fa-chevron-down]="!mostrarFiltros"
            [class.fa-chevron-up]="mostrarFiltros"
            class="fas mr-1"
          ></i>
          {{ mostrarFiltros ? 'Ocultar' : 'Mostrar' }} filtros
        </button>
      </div>

      <div
        *ngIf="mostrarFiltros"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
      >
        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-2">
            Estado
          </label>
          <select
            [(ngModel)]="estadoFiltro"
            (change)="onFiltroChange()"
            class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
          >
            <option [ngValue]="null">Todos</option>
            <option *ngFor="let estado of estados" [value]="estado.valor">
              {{ estado.etiqueta }}
            </option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-2">
            PDF Generado
          </label>
          <select
            [(ngModel)]="tienePdfFiltro"
            (change)="onFiltroChange()"
            class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
          >
            <option [ngValue]="null">Todos</option>
            <option value="true">Sí</option>
            <option value="false">No</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-2">
            Correo Enviado
          </label>
          <select
            [(ngModel)]="siEnvioCorreoFiltro"
            (change)="onFiltroChange()"
            class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
          >
            <option [ngValue]="null">Todos</option>
            <option value="true">Sí</option>
            <option value="false">No</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-2">
            Fecha de Inicio
          </label>
          <input
            type="date"
            [(ngModel)]="fechaInicio"
            (change)="onFiltroChange()"
            class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-2">
            Fecha de Fin
          </label>
          <input
            type="date"
            [(ngModel)]="fechaFin"
            (change)="onFiltroChange()"
            class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
          />
        </div>

        <div class="flex items-end">
          <button
            (click)="onLimpiarFiltros()"
            type="button"
            class="w-full px-4 py-2 bg-neutral-100 text-neutral-700 rounded-lg hover:bg-neutral-200 transition-colors"
          >
            <i class="fas fa-times mr-2"></i>
            Limpiar Filtros
          </button>
        </div>
      </div>
    </div>
  </div>

  <app-tabla-paginada
    titulo=""
    textoBotonCrear=""
    iconoBotonCrear=""
    placeholderBusqueda=""
    [datos]="datos"
    [cargando]="cargando"
    [columnas]="columnas"
    [templatesPersonalizados]="templatesPersonalizados"
    [acciones]="true"
    [mostrarBusqueda]="false"
    [mostrarPaginacion]="true"
    (cambiarPagina)="onCambiarPagina($event)"
    (cambiarTamanoPagina)="onCambiarTamanoPagina($event)"
    (filaClick)="onFilaClick($event)"
    (ordenar)="onOrdenar($event)"
    (accionSeleccionada)="onAccionSeleccionada($event)"
  ></app-tabla-paginada>
</div>

<!-- Templates personalizados -->
<ng-template #templateCliente let-valor let-item="item">
  <button
    type="button"
    (click)="verDetalleCliente(item.cliente_id); $event.stopPropagation()"
    class="text-primary-600 hover:text-primary-700 hover:underline transition-colors font-medium"
  >
    {{ valor }}
  </button>
</ng-template>

<ng-template #templateEstado let-valor let-item="item">
  <span
    *ngIf="valor === 'pendiente'"
    class="px-2 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800"
  >
    Pendiente
  </span>
  <span
    *ngIf="valor === 'pagada'"
    class="px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800"
  >
    Pagada
  </span>
  <span
    *ngIf="valor === 'mora'"
    class="px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800"
  >
    Mora
  </span>
  <span
    *ngIf="valor === 'cancelada'"
    class="px-2 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-800"
  >
    Cancelada
  </span>
</ng-template>

<ng-template #templatePdf let-valor let-item="item">
  <button
    *ngIf="valor"
    type="button"
    (click)="descargarPdf(item.id); $event.stopPropagation()"
    class="text-primary-600 hover:text-primary-700 transition-colors"
    title="Ver PDF"
  >
    <i class="fas fa-file-pdf text-lg"></i>
  </button>
  <span *ngIf="!valor" class="text-neutral-400">-</span>
</ng-template>

<ng-template #templateCorreo let-valor>
  <i *ngIf="valor" class="fas fa-check-circle text-green-600 text-lg"></i>
  <i *ngIf="!valor" class="fas fa-times-circle text-red-600 text-lg"></i>
</ng-template>
